layout: default
---
<section class="country-index" data-country-page="{{ page.country_slug }}">
  <header class="country-index__header">
    <p class="eyebrow">Country</p>
    <h1>{{ page.title }}</h1>
    <p class="lead">Explore farms, markets, stores, restaurants, and hubs contributing to transparent food systems in {{ page.title }}.</p>
  </header>

  <div class="country-index__content">
    {% assign collection_map = 'Farms:farms,Markets:markets,Stores:stores,Restaurants:restaurants,Hubs:distributors' | split: ',' %}
    {% for entry in collection_map %}
      {% assign parts = entry | split: ':' %}
      {% assign label = parts[0] %}
      {% assign key = parts[1] %}
      {% assign items = site[key] | where: 'country_slug', page.country_slug | sort: 'title' %}
      <section class="country-section">
        <div class="country-section__header">
          <h2>{{ label }}</h2>
          <p class="muted">{{ items.size }} listing{% if items.size != 1 %}s{% endif %}</p>
        </div>
        {% if items.size > 0 %}
        <div class="listing-grid">
          {% for listing in items %}
            {% include listing-card.html listing=listing %}
          {% endfor %}
        </div>
        {% else %}
        <p class="muted">No listings added yet. Contribute one to get started.</p>
        {% endif %}
      </section>
    {% endfor %}
  </div>
</section>

{% assign country_items = site.farms | where: 'country_slug', page.country_slug | concat: site.markets | where: 'country_slug', page.country_slug %}
{% assign country_items = country_items | concat: site.stores | where: 'country_slug', page.country_slug %}
{% assign country_items = country_items | concat: site.restaurants | where: 'country_slug', page.country_slug %}
{% assign country_items = country_items | concat: site.distributors | where: 'country_slug', page.country_slug %}
{% assign country_items = country_items | concat: site.vendors | where: 'country_slug', page.country_slug %}
{% assign country_items = country_items | uniq %}
{% if country_items and country_items.size > 0 %}
{%- comment -%}Country-level CollectionPage + ItemList schema for all listings in this country.{%- endcomment -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "name": "{{ page.title | escape }} listings",
  "description": "Directory of farms, markets, grocers, eateries, and hubs in {{ page.title | escape }}.",
  "url": "{{ page.url | absolute_url }}",
  "mainEntity": {
    "@type": "ItemList",
    "itemListOrder": "https://schema.org/ItemListOrderAscending",
    "numberOfItems": {{ country_items.size }},
    "itemListElement": [
      {% for listing in country_items %}
      {
        "@type": "ListItem",
        "position": {{ forloop.index }},
        "name": "{{ listing.title | default: listing.name | escape }}",
        "url": "{{ listing.url | absolute_url }}"
      }{% unless forloop.last %},{% endunless %}
      {% endfor %}
    ]
  }
}
</script>
{% endif %}

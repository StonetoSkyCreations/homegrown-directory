---
layout: default
map: false
---
{% assign empty_array = "" | split: "" %}
{% assign display_title = page.title | default: page.name %}
{% assign supplies_list = page.supplies_to | default: empty_array %}
{% assign sourced_from_list = page.sourced_from | default: empty_array %}
{% assign all_listings = site.farms | concat: site.markets | concat: site.stores | concat: site.restaurants | concat: site.distributors | concat: site.vendors %}
{% assign outgoing_supplies = all_listings | where_exp: 'item', 'supplies_list contains item.slug' | uniq %}
{% assign incoming_from_supplies = all_listings | where_exp: 'item', 'item.supplies_to contains page.slug' %}
{% assign incoming_from_sources = all_listings | where_exp: 'item', 'item.sourced_from contains page.slug' %}
{% assign incoming_sources = incoming_from_supplies | concat: incoming_from_sources | uniq | where_exp: 'item', 'item.slug != page.slug' %}
{% assign source_partners = all_listings | where_exp: 'item', 'sourced_from_list contains item.slug' | uniq %}
{% assign sourced_from_text_list = page.sourced_from_text | default: empty_array %}
{% assign supplies_to_text_list = page.supplies_to_text | default: empty_array %}
{% assign sourced_from_text_clean = "" %}
{% for entry in sourced_from_text_list %}
  {% assign value = entry | to_s | strip %}
  {% assign looks_like_url = false %}
  {% if value contains '://' or value contains 'www.' %}
    {% assign looks_like_url = true %}
  {% endif %}
  {% unless looks_like_url or value == "" %}
    {% if sourced_from_text_clean == "" %}
      {% assign sourced_from_text_clean = value %}
    {% else %}
      {% assign sourced_from_text_clean = sourced_from_text_clean | append: "||" | append: value %}
    {% endif %}
  {% endunless %}
{% endfor %}
{% if sourced_from_text_clean == "" %}
  {% assign sourced_from_text_clean = empty_array %}
{% else %}
  {% assign sourced_from_text_clean = sourced_from_text_clean | split: "||" %}
{% endif %}
{% assign supplies_to_text_clean = "" %}
{% for entry in supplies_to_text_list %}
  {% assign value = entry | to_s | strip %}
  {% assign looks_like_url = false %}
  {% if value contains '://' or value contains 'www.' %}
    {% assign looks_like_url = true %}
  {% endif %}
  {% unless looks_like_url or value == "" %}
    {% if supplies_to_text_clean == "" %}
      {% assign supplies_to_text_clean = value %}
    {% else %}
      {% assign supplies_to_text_clean = supplies_to_text_clean | append: "||" | append: value %}
    {% endif %}
  {% endunless %}
{% endfor %}
{% if supplies_to_text_clean == "" %}
  {% assign supplies_to_text_clean = empty_array %}
{% else %}
  {% assign supplies_to_text_clean = supplies_to_text_clean | split: "||" %}
{% endif %}
{% assign schema_type = 'LocalBusiness' %}
{% assign display_label = page.collection | capitalize %}
{% assign review_target = page.slug | default: page.title | slugify %}
{% assign encoded_title = page.title | default: page.name | uri_escape %}
{% assign website_url = page.website | default: "" %}
{% if website_url != "" and website_url contains "://" %}
{% elsif website_url != "" %}
  {% assign website_url = "https://" | append: website_url %}
{% endif %}
{% assign short_description = page.description | default: page.excerpt | default: "" %}
{% assign trimmed_body = content | strip %}
{% assign social_links = page.social_links | default: page.social | default: "" %}
{% assign social_array = "" | split: "" %}
{% if social_links %}
  {% assign social_json = social_links | jsonify %}
  {% assign social_type = social_json | slice: 0, 1 %}
  {% if social_type == '{' %}
    {% for pair in social_links %}
      {% assign link = pair[1] | to_s | strip %}
      {% if link != "" %}
        {% assign social_array = social_array | push: link %}
      {% endif %}
    {% endfor %}
  {% elsif social_type == '[' %}
    {% for link in social_links %}
      {% assign link_value = link | to_s | strip %}
      {% if link_value != "" %}
        {% assign social_array = social_array | push: link_value %}
      {% endif %}
    {% endfor %}
  {% else %}
    {% assign social_array = social_links | split: ',' %}
  {% endif %}
{% endif %}
{% if page.website %}
  {% assign social_array = social_array | push: page.website %}
{% endif %}
{% assign social_array = social_array | uniq %}
{% include contact-hours-normalize.html entity=page %}
{% assign contact_email_count = contact_emails | size %}
{% assign contact_phone_count = contact_phones | size %}
{% assign primary_phone_display = contact_phones | first | to_s | strip %}
{% case page.collection %}
  {% when 'farms' %}{% assign schema_type = 'Farm' %}{% assign display_label = 'Farm' %}
  {% when 'restaurants' %}{% assign schema_type = 'Restaurant' %}{% assign display_label = 'Eatery' %}
  {% when 'vendors' %}{% assign schema_type = 'Restaurant' %}{% assign display_label = 'Eatery' %}
  {% when 'stores' %}
    {% if page.category == 'cafe' or page.type contains 'Cafe' or page.type contains 'cafe' %}
      {% assign schema_type = 'CafeOrCoffeeShop' %}
    {% else %}
      {% assign schema_type = 'GroceryStore' %}
    {% endif %}
    {% assign display_label = 'Grocer' %}
  {% when 'markets' %}{% assign schema_type = 'FarmersMarket' %}{% assign display_label = 'Market' %}
  {% when 'distributors' %}{% assign schema_type = 'WholesaleStore' %}{% assign display_label = 'Hub' %}
{% endcase %}

<section class="listing">
  <header class="listing__header">
    <div class="listing__header-row">
      <div>
        <p class="listing__type">{{ display_label }}</p>
        <h1>{{ display_title }}</h1>
        <p class="listing__location">
          {% include address-block.html %}
        </p>
{% if website_url != "" or contact_email_count > 0 or contact_phone_count > 0 %}
  <div class="listing__contact">
    {% if website_url != "" %}<a href="{{ website_url }}" rel="noopener">Website</a>{% endif %}
    {% if primary_email != "" %}<a href="mailto:{{ primary_email }}">Email</a>{% endif %}
    {% if primary_phone_display != "" %}<a href="tel:{{ ld_phone }}">Phone</a>{% endif %}
  </div>
{% endif %}
      </div>
      <div class="share-control" data-share>
        <button type="button" class="button ghost share-button" aria-expanded="false">
          Share
        </button>
        <div class="share-menu" role="menu">
          <button type="button" class="share-menu__item" data-share-copy>Copy link</button>
          <a class="share-menu__item" data-share-email href="#" role="menuitem">Email</a>
          <a class="share-menu__item" data-share-facebook href="#" role="menuitem">Facebook</a>
        </div>
      </div>
    </div>
  </header>

  <div class="listing__content">
    {% assign has_long_description = page.long_description | to_s | strip %}
    {% if has_long_description != "" %}
      <div class="listing__body">
        {{ page.long_description | markdownify }}
      </div>
    {% elsif trimmed_body != "" %}
      <div class="listing__body">
        {{ content }}
      </div>
    {% elsif short_description != "" %}
      <div class="listing__body">
        <p>{{ short_description }}</p>
      </div>
    {% endif %}

    {% if page.featured_article %}
    <div class="listing__featured-article">
      <h3>Featured story</h3>
      {% assign featured_post = site.posts | where: "url", page.featured_article | first %}
      {% if featured_post %}
        <p><a href="{{ featured_post.url | relative_url }}">{{ featured_post.title }}</a></p>
      {% else %}
        <p><a href="{{ page.featured_article }}">Read the full profile â†’</a></p>
      {% endif %}
    </div>
    {% endif %}

    <section class="listing-updates-reviews">
      {% include listing-reviews.html listing=page %}
    </section>
  </div>

  <div class="listing__meta">
    <div class="listing__meta-top">
      {% include rating.html listing=page %}
    </div>
    <div class="listing__actions">
      <a class="button ghost" href="{{ '/submit.html?submission_type=update&listing=' | append: review_target | append: '&name=' | append: encoded_title | relative_url }}">Update listing</a>
      <a class="button ghost" href="{{ '/review.html?listing=' | append: review_target | relative_url }}">Review this place</a>
    </div>

    {% assign practices_list = page.practices | default: empty_array | where_exp: "item", "item != nil and item != ''" %}
    {% if practices_list and practices_list.size > 0 %}
      <div>
        <h2>Practices</h2>
        <ul class="tag-list">
          {% for practice in practices_list %}
          <li>{{ practice }}</li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}

    {% assign products_list = page.products | default: empty_array | where_exp: "item", "item != nil and item != ''" %}
    {% if products_list and products_list.size > 0 %}
      <div>
        <h2>Products</h2>
        <ul class="tag-list">
          {% for product in products_list %}
          <li>{{ product }}</li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}

    {% assign services_list = page.services | default: empty_array | where_exp: "item", "item != nil and item != ''" %}
    {% if services_list and services_list.size > 0 %}
      <div>
        <h2>Services & sales channels</h2>
        <ul class="tag-list">
          {% for service in services_list %}
          <li>{{ service }}</li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}

    {% assign hours_count = hours_lines | size %}
    {% if hours_count > 0 %}
      <div>
        <h2>Hours / schedule</h2>
        {% if hours_count == 1 %}
          <p class="muted">{{ hours_lines[0] }}</p>
        {% else %}
          <ul class="list-plain">
            {% for entry in hours_lines %}
            <li>{{ entry }}</li>
            {% endfor %}
          </ul>
        {% endif %}
      </div>
    {% endif %}

    {% assign market_days_list = page.market_days | default: empty_array | where_exp: "item", "item != nil and item != ''" %}
    {% if market_days_list and market_days_list.size > 0 %}
      <div>
        <h2>Market days</h2>
        <ul class="list-plain">
          {% for day in market_days_list %}
          <li>{{ day }}</li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}

    {% assign source_link_count = source_partners | size %}
    {% assign source_text_count = sourced_from_text_clean | size %}
    {% if source_link_count > 0 or source_text_count > 0 %}
      <div>
        <h2>Sourced from</h2>
        {% if source_link_count > 0 %}
        <ul class="link-list">
          {% for item in source_partners %}
            <li><a href="{{ item.url | relative_url }}">{{ item.title }}</a> <span class="muted">({{ item.collection | capitalize }})</span></li>
          {% endfor %}
        </ul>
        {% endif %}
        {% if source_text_count > 0 %}
        <ul class="tag-list">
          {% for line in sourced_from_text_clean %}
          <li>{{ line }}</li>
          {% endfor %}
        </ul>
        {% endif %}
      </div>
    {% endif %}

    {% assign supplies_link_count = outgoing_supplies | size %}
    {% assign supplies_text_count = supplies_to_text_clean | size %}
    {% if supplies_link_count > 0 or supplies_text_count > 0 %}
      <div>
        <h2>Supplies to</h2>
        {% if supplies_link_count > 0 %}
        <ul class="link-list">
          {% for item in outgoing_supplies %}
            <li><a href="{{ item.url | relative_url }}">{{ item.title }}</a> <span class="muted">({{ item.collection | capitalize }})</span></li>
          {% endfor %}
        </ul>
        {% endif %}
        {% if supplies_text_count > 0 %}
        <ul class="tag-list">
          {% for line in supplies_to_text_clean %}
          <li>{{ line }}</li>
          {% endfor %}
        </ul>
        {% endif %}
      </div>
    {% endif %}

    {% if incoming_sources and incoming_sources.size > 0 %}
      <div>
        <h2>Also referenced by</h2>
        <ul class="link-list">
          {% for item in incoming_sources %}
            <li><a href="{{ item.url | relative_url }}">{{ item.title }}</a> <span class="muted">({{ item.collection | capitalize }})</span></li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}
  </div>
</section>

{% comment %}Structured data for LocalBusiness + optional FAQ (driven by front matter).{% endcomment %}
{% assign ld_description = page.description | default: page.excerpt | default: page.seo_description | default: page.long_description | default: "" | strip_html | strip_newlines %}
{% assign ld_website = website_url | to_s | strip %}
{% assign ld_phone = contact_phones | first | to_s | replace: ' ', '' | replace: '(', '' | replace: ')', '' | strip %}
{% assign ld_email = primary_email | to_s | strip %}
{% assign ld_hours = hours_ld_string | to_s | strip %}
{% assign social_array = social_array | join: ',' | split: ',' | uniq %}
{% assign social_clean = "" | split: "|" %}
{% for link in social_array %}
  {% assign link_value = link | to_s | strip %}
  {% unless link_value == "" %}
    {% assign social_clean = social_clean | push: link_value %}
  {% endunless %}
{% endfor %}
{% assign social_array = social_clean %}
{% assign social_count = social_array | size %}
{% assign country_clean = page.country | to_s | strip %}
<script type="application/ld+json">
{% assign ld_properties = "" | split: "|" %}
{% capture ld_context %}"@context": "https://schema.org"{% endcapture %}
{% assign ld_properties = ld_properties | push: ld_context %}
{% capture ld_type %}"@type": "{{ schema_type }}"{% endcapture %}
{% assign ld_properties = ld_properties | push: ld_type %}
{% capture ld_name %}"name": "{{ display_title | escape }}"{% endcapture %}
{% assign ld_properties = ld_properties | push: ld_name %}
{% capture ld_description_prop %}"description": "{{ ld_description | escape }}"{% endcapture %}
{% assign ld_properties = ld_properties | push: ld_description_prop %}
{% assign ld_url = page.url | absolute_url %}
{% if ld_website != "" %}
  {% capture ld_url_prop %}"url": "{{ ld_website | escape }}"{% endcapture %}
{% else %}
  {% capture ld_url_prop %}"url": "{{ ld_url | escape }}"{% endcapture %}
{% endif %}
{% assign ld_properties = ld_properties | push: ld_url_prop %}
{% capture main_entity_prop %}"mainEntityOfPage": "{{ ld_url | escape }}"{% endcapture %}
{% assign ld_properties = ld_properties | push: main_entity_prop %}

{% if page.address or page.city or page.region or page.country or page.postcode %}
  {% assign locality = nil %}
  {% if page.suburb and page.city %}
    {% assign locality = page.suburb | append: ", " | append: page.city %}
  {% elsif page.city %}
    {% assign locality = page.city %}
  {% elsif page.suburb %}
    {% assign locality = page.suburb %}
  {% endif %}
  {% assign address_value = page.address | to_s | strip %}
  {% assign locality_value = locality | to_s | strip %}
  {% assign region_value = page.region | to_s | strip %}
  {% assign postcode_value = page.postcode | to_s | strip %}
  {% assign country_value = page.country | to_s | strip %}
  {% assign address_parts = "" | split: "|" %}
  {% if address_value != "" %}{% capture street_prop %}"streetAddress": "{{ address_value | escape }}"{% endcapture %}{% assign address_parts = address_parts | push: street_prop %}{% endif %}
  {% if locality_value != "" %}{% capture locality_prop %}"addressLocality": "{{ locality_value | escape }}"{% endcapture %}{% assign address_parts = address_parts | push: locality_prop %}{% endif %}
  {% if region_value != "" %}{% capture region_prop %}"addressRegion": "{{ region_value | escape }}"{% endcapture %}{% assign address_parts = address_parts | push: region_prop %}{% endif %}
  {% if postcode_value != "" %}{% capture postcode_prop %}"postalCode": "{{ postcode_value | escape }}"{% endcapture %}{% assign address_parts = address_parts | push: postcode_prop %}{% endif %}
  {% if country_value != "" %}{% capture country_prop %}"addressCountry": "{{ country_value | escape }}"{% endcapture %}{% assign address_parts = address_parts | push: country_prop %}{% endif %}
  {% if address_parts.size > 0 %}
    {% capture address_separator %},
      {% endcapture %}
    {% capture address_prop %}"address": {
      {{ address_parts | join: address_separator }}
    }{% endcapture %}
    {% assign ld_properties = ld_properties | push: address_prop %}
  {% endif %}
{% endif %}

{% if ld_hours != "" %}
  {% capture opening_prop %}"openingHours": "{{ ld_hours | escape }}"{% endcapture %}
  {% assign ld_properties = ld_properties | push: opening_prop %}
{% endif %}
{% if ld_phone != "" %}
  {% capture phone_prop %}"telephone": "{{ ld_phone | escape }}"{% endcapture %}
  {% assign ld_properties = ld_properties | push: phone_prop %}
{% endif %}
{% if ld_email != "" %}
  {% capture email_prop %}"email": "{{ ld_email | escape }}"{% endcapture %}
  {% assign ld_properties = ld_properties | push: email_prop %}
{% endif %}
{% assign lat_value = page.lat | to_s | strip %}
{% assign lon_value = page.lon | to_s | strip %}
{% if lat_value != "" and lon_value != "" %}
  {% capture geo_prop %}"geo": {
    "@type": "GeoCoordinates",
    "latitude": {{ lat_value }},
    "longitude": {{ lon_value }}
  }{% endcapture %}
  {% assign ld_properties = ld_properties | push: geo_prop %}
{% endif %}
{% if social_count > 0 %}
  {% capture same_as_prop %}"sameAs": [{% for link in social_array %}"{{ link | escape }}"{% unless forloop.last %}, {% endunless %}{% endfor %}]{% endcapture %}
  {% assign ld_properties = ld_properties | push: same_as_prop %}
{% endif %}
{% if page.products_or_cuisine and page.products_or_cuisine != empty %}
  {% capture cuisine_prop %}"servesCuisine": [{% for item in page.products_or_cuisine %}"{{ item | escape }}"{% unless forloop.last %}, {% endunless %}{% endfor %}]{% endcapture %}
  {% assign ld_properties = ld_properties | push: cuisine_prop %}
{% elsif page.products and page.products != empty %}
  {% capture cuisine_prop %}"servesCuisine": [{% for item in page.products limit: 4 %}"{{ item | escape }}"{% unless forloop.last %}, {% endunless %}{% endfor %}]{% endcapture %}
  {% assign ld_properties = ld_properties | push: cuisine_prop %}
{% endif %}
{% if country_clean != "" %}
  {% capture area_served_prop %}"areaServed": "{{ country_clean | escape }}"{% endcapture %}
  {% assign ld_properties = ld_properties | push: area_served_prop %}
{% endif %}
{
  {% capture ld_separator %},
  {% endcapture %}
  {{ ld_properties | join: ld_separator }}
}
</script>

{% if page.faqs %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {% for faq in page.faqs %}
    {
      "@type": "Question",
      "name": "{{ faq.question | escape }}",
      "acceptedAnswer": { "@type": "Answer", "text": "{{ faq.answer | strip_html | strip_newlines | escape }}" }
    }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ]
}
</script>
{% endif %}

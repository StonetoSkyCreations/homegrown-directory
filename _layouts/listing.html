---
layout: default
map: false
---
{% assign empty_array = "" | split: "" %}
{% assign display_title = page.title | default: page.name %}
{% assign supplies_list = page.supplies_to | default: empty_array %}
{% assign sources_list = page.sources | default: empty_array %}
{% assign all_listings = site.farms | concat: site.markets | concat: site.stores | concat: site.restaurants | concat: site.distributors | concat: site.vendors %}
{% assign outgoing_supplies = all_listings | where_exp: 'item', 'supplies_list contains item.slug' | uniq %}
{% assign incoming_from_supplies = all_listings | where_exp: 'item', 'item.supplies_to contains page.slug' %}
{% assign incoming_from_sources = all_listings | where_exp: 'item', 'item.sources contains page.slug' %}
{% assign incoming_sources = incoming_from_supplies | concat: incoming_from_sources | uniq | where_exp: 'item', 'item.slug != page.slug' %}
{% assign source_partners = all_listings | where_exp: 'item', 'sources_list contains item.slug' | uniq %}
{% assign schema_type = 'LocalBusiness' %}
{% assign display_label = page.collection | capitalize %}
{% assign review_target = page.slug | default: page.title | slugify %}
{% assign encoded_title = page.title | default: page.name | uri_escape %}
{% assign website_url = page.website | default: "" %}
{% if website_url != "" and website_url contains "://" %}
{% elsif website_url != "" %}
  {% assign website_url = "https://" | append: website_url %}
{% endif %}
{% assign phone_href = page.phone | default: "" | replace: ' ', '' | replace: '(', '' | replace: ')', '' %}
{% assign short_description = page.description | default: page.excerpt | default: "" %}
{% assign trimmed_body = content | strip %}
{% assign social_links = page.social_links | default: page.social | default: "" %}
{% assign social_array = "" | split: "" %}
{% if social_links %}
  {% if social_links.first %}
    {% assign social_array = social_links %}
  {% else %}
    {% assign social_array = social_links | split: ',' %}
  {% endif %}
{% endif %}
{% if page.website %}
  {% assign social_array = social_array | push: page.website %}
{% endif %}
{% assign social_array = social_array | uniq %}
{% case page.collection %}
  {% when 'farms' %}{% assign schema_type = 'Farm' %}{% assign display_label = 'Farm' %}
  {% when 'restaurants' %}{% assign schema_type = 'Restaurant' %}{% assign display_label = 'Eatery' %}
  {% when 'vendors' %}{% assign schema_type = 'Restaurant' %}{% assign display_label = 'Eatery' %}
  {% when 'stores' %}
    {% if page.category == 'cafe' or page.type contains 'Cafe' or page.type contains 'cafe' %}
      {% assign schema_type = 'CafeOrCoffeeShop' %}
    {% else %}
      {% assign schema_type = 'GroceryStore' %}
    {% endif %}
    {% assign display_label = 'Grocer' %}
  {% when 'markets' %}{% assign schema_type = 'FarmersMarket' %}{% assign display_label = 'Market' %}
  {% when 'distributors' %}{% assign schema_type = 'WholesaleStore' %}{% assign display_label = 'Hub' %}
{% endcase %}

<section class="listing">
  <header class="listing__header">
    <div>
      <p class="listing__type">{{ display_label }}</p>
      <h1>{{ display_title }}</h1>
      <p class="listing__location">
        {% include address-block.html %}
      </p>
      {% if website_url != "" or page.email or phone_href != "" %}
      <div class="listing__contact">
        {% if website_url != "" %}<a href="{{ website_url }}" rel="noopener">Website</a>{% endif %}
        {% if page.email %}<a href="mailto:{{ page.email }}">Email</a>{% endif %}
        {% if phone_href != "" %}<a href="tel:{{ phone_href }}">{{ page.phone }}</a>{% endif %}
      </div>
      {% endif %}
    </div>
  </header>

  <div class="listing__content">
    {% if short_description != "" %}
    <div class="listing__intro">
      <p>{{ short_description }}</p>
    </div>
    {% endif %}

    {% if trimmed_body != "" %}
    <div class="listing__body">
      {{ content }}
    </div>
    {% endif %}

    <section class="listing-updates-reviews">
      <!-- Future: injected updates, user reviews, or extra content blocks -->
    </section>
  </div>

  <div class="listing__meta">
    <div class="listing__actions">
      <a class="button ghost" href="{{ '/submit.html?submission_type=update&listing=' | append: review_target | append: '&name=' | append: encoded_title | relative_url }}">Update listing</a>
      <a class="button ghost" href="{{ '/review.html?listing=' | append: review_target | relative_url }}">Review this place</a>
    </div>
    {% include rating.html listing=page %}

    {% if page.practices %}
      <div>
        <h2>Practices</h2>
        <ul class="tag-list">
          {% for practice in page.practices %}
          <li>{{ practice }}</li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}

    {% if page.products %}
      <div>
        <h2>Products</h2>
        <ul class="tag-list">
          {% for product in page.products %}
          <li>{{ product }}</li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}

    {% if page.services %}
      <div>
        <h2>Services & sales channels</h2>
        <ul class="tag-list">
          {% for service in page.services %}
          <li>{{ service }}</li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}

    {% if page.hours_list %}
      <div>
        <h2>Hours / schedule</h2>
        <ul class="tag-list">
          {% for entry in page.hours_list %}
          <li>{{ entry }}</li>
          {% endfor %}
        </ul>
      </div>
    {% elsif page.hours %}
      <div>
        <h2>Hours / schedule</h2>
        <p class="muted">{{ page.hours }}</p>
      </div>
    {% endif %}

    {% if page.market_days %}
      <div>
        <h2>Market days</h2>
        <ul class="tag-list">
          {% for day in page.market_days %}
          <li>{{ day }}</li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}

    {% if source_partners and source_partners.size > 0 %}
      <div>
        <h2>Sourced from</h2>
        <ul class="link-list">
          {% for item in source_partners %}
            <li><a href="{{ item.url | relative_url }}">{{ item.title }}</a> <span class="muted">({{ item.collection | capitalize }})</span></li>
          {% endfor %}
        </ul>
      </div>
    {% elsif page.sourced_from_text %}
      <div>
        <h2>Sourced from</h2>
        <ul class="tag-list">
          {% for line in page.sourced_from_text %}
          <li>{{ line }}</li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}

    {% if outgoing_supplies and outgoing_supplies.size > 0 %}
      <div>
        <h2>Supplies to</h2>
        <ul class="link-list">
          {% for item in outgoing_supplies %}
            <li><a href="{{ item.url | relative_url }}">{{ item.title }}</a> <span class="muted">({{ item.collection | capitalize }})</span></li>
          {% endfor %}
        </ul>
      </div>
    {% elsif page.supplies_to_text %}
      <div>
        <h2>Supplies to</h2>
        <ul class="tag-list">
          {% for line in page.supplies_to_text %}
          <li>{{ line }}</li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}

    {% if incoming_sources %}
      <div>
        <h2>Also referenced by</h2>
        <ul class="link-list">
          {% for item in incoming_sources %}
            <li><a href="{{ item.url | relative_url }}">{{ item.title }}</a> <span class="muted">({{ item.collection | capitalize }})</span></li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}
  </div>
</section>

{% comment %}Structured data for LocalBusiness + optional FAQ (driven by front matter).{% endcomment %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "{{ schema_type }}",
  "name": "{{ display_title | escape }}",
  "description": "{{ page.description | default: page.excerpt | strip_html | strip_newlines | escape }}",
  {% if website_url != "" %}
  "url": "{{ website_url | escape }}",
  {% else %}
  "url": "{{ page.url | absolute_url }}",
  {% endif %}
  "mainEntityOfPage": "{{ page.url | absolute_url }}",
  {% if page.address or page.city or page.region or page.country or page.postcode %}
  "address": {
    "@type": "PostalAddress",
    {% if page.address %}"streetAddress": "{{ page.address | escape }}",{% endif %}
    {% if page.suburb %}"addressLocality": "{{ page.suburb | escape }}",{% endif %}
    {% if page.city %}"addressLocality": "{{ page.city | escape }}",{% endif %}
    {% if page.region %}"addressRegion": "{{ page.region | escape }}",{% endif %}
    {% if page.postcode %}"postalCode": "{{ page.postcode | escape }}",{% endif %}
    {% if page.country %}"addressCountry": "{{ page.country | escape }}"{% endif %}
  },
  {% endif %}
  {% if page.lat and page.lon %}
  "geo": {
    "@type": "GeoCoordinates",
    "latitude": {{ page.lat | jsonify }},
    "longitude": {{ page.lon | jsonify }}
  },
  {% endif %}
  {% if page.hours %}"openingHours": "{{ page.hours | escape }}",{% endif %}
  {% if page.phone %}"telephone": "{{ page.phone | escape }}",{% endif %}
  {% if page.email %}"email": "{{ page.email | escape }}",{% endif %}
  {% if social_array and social_array != empty %}
  "sameAs": [{% for link in social_array %}"{{ link | strip | escape }}"{% unless forloop.last %},{% endunless %}{% endfor %}],
  {% endif %}
  {% if page.products_or_cuisine and page.products_or_cuisine != empty %}
  "servesCuisine": [{% for item in page.products_or_cuisine %}"{{ item | escape }}"{% unless forloop.last %},{% endunless %}{% endfor %}],
  {% elsif page.products and page.products != empty %}
  "servesCuisine": [{% for item in page.products limit: 4 %}"{{ item | escape }}"{% unless forloop.last %},{% endunless %}{% endfor %}],
  {% endif %}
  {% if page.rating_average and page.rating_count %}
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "{{ page.rating_average }}",
    "reviewCount": "{{ page.rating_count }}"
  },
  {% endif %}
  "areaServed": "{{ page.country | escape }}"
}
</script>

{% if page.faqs %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {% for faq in page.faqs %}
    {
      "@type": "Question",
      "name": "{{ faq.question | escape }}",
      "acceptedAnswer": { "@type": "Answer", "text": "{{ faq.answer | strip_html | strip_newlines | escape }}" }
    }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ]
}
</script>
{% endif %}

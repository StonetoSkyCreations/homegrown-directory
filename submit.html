---
layout: default
title: Add or Update a Listing
permalink: /submit.html
---
<section class="form-page">
  <header class="collection-index__header">
    <p class="eyebrow">Contribute</p>
    <h1>Add or Update a Listing</h1>
    <p class="lead">Use this form to add new farms, stores, cafés, restaurants, markets, or hubs, or to update an existing listing. On submit, your email client will open with the details prefilled.</p>
  </header>

  <form id="submitForm">
    <div class="form-group">
      <label>Submission type</label>
      <div class="pill-group">
        <label class="pill pill--checkbox">
          <input type="radio" name="submission_type" value="new" checked>
          <span>Add new listing</span>
        </label>
        <label class="pill pill--checkbox">
          <input type="radio" name="submission_type" value="update">
          <span>Update existing listing</span>
        </label>
      </div>
    </div>

    <div class="form-group">
      <label class="pill pill--checkbox">
        <input type="checkbox" id="owner_checkbox" name="owner_checkbox">
        <span>I’m the business owner</span>
      </label>
    </div>

    <div class="form-group">
      <label for="submitter_name">Your name (optional)</label>
      <input type="text" id="submitter_name" name="submitter_name" placeholder="For follow-up">
    </div>

    <div class="form-group">
      <label for="submitter_email">Your email (optional)</label>
      <input type="email" id="submitter_email" name="submitter_email" placeholder="you@example.com">
    </div>

    <div class="form-group">
      <label for="place_type">Type of place</label>
      <select id="place_type" name="place_type" required>
        <option value="" disabled selected>Select type</option>
        <option value="farms">Farm / Producer</option>
        <option value="stores">Grocery / Wholefood store / Refill</option>
        <option value="restaurants">Café / Restaurant</option>
        <option value="vendors">Food truck / Mobile vendor</option>
        <option value="markets">Market / Farmers’ market</option>
        <option value="distributors">Distributor / Food hub</option>
        <option value="community">Community / grassroots initiative</option>
      </select>
    </div>

    <div class="form-group">
      <label for="name">Business name</label>
      <input type="text" id="name" name="name" required>
    </div>

    <div class="form-group split">
      <div>
        <label for="country_slug">Country</label>
        <select id="country_slug" name="country_slug">
          <option value="new-zealand" selected>New Zealand</option>
          <option value="australia">Australia</option>
        </select>
      </div>
      <div>
        <label for="region">Region</label>
        <input type="text" id="region" name="region" placeholder="e.g. Wellington">
      </div>
    </div>

    <div class="form-group split">
      <div>
        <label for="city">City / town</label>
        <input type="text" id="city" name="city" placeholder="e.g. Masterton">
      </div>
      <div>
        <label for="suburb">Suburb</label>
        <input type="text" id="suburb" name="suburb" placeholder="e.g. Brooklyn">
      </div>
    </div>

    <div class="form-group">
      <label for="address">Street address (optional)</label>
      <input type="text" id="address" name="address" placeholder="123 Example St">
    </div>

    <div class="form-group">
      <label for="postcode">Postcode (optional)</label>
      <input type="text" id="postcode" name="postcode" placeholder="e.g. 6011">
    </div>

    <div class="form-group split">
      <div>
        <label for="website">Website (optional)</label>
        <input type="url" id="website" name="website" placeholder="https://">
      </div>
      <div>
        <label for="social">Social links (optional)</label>
        <textarea id="social" name="social" rows="2" placeholder="https:// (one per line or comma separated)"></textarea>
      </div>
    </div>

    <div class="form-group split">
      <div>
        <label for="email">Contact email (optional)</label>
        <input type="email" id="email" name="email" placeholder="you@example.com">
      </div>
      <div>
        <label for="phone">Contact phone (optional)</label>
        <input type="text" id="phone" name="phone" placeholder="+64...">
      </div>
    </div>

    <div class="form-group">
      <label for="short_description">Short description</label>
      <textarea id="short_description" name="short_description" rows="3" placeholder="1–2 sentences for the listing card"></textarea>
    </div>

    <div class="form-group">
      <label for="full_description">More details (optional)</label>
      <textarea id="full_description" name="full_description" rows="6" placeholder="Extra context or story. Markdown accepted."></textarea>
    </div>

    <div class="form-group">
      <label>Practices</label>
      <div class="pill-group">
        {% assign tags = "Certified organic,Spray-free / organic but uncertified,Regenerative / agroecological,Biodynamic,Wild / foraged,Pasture-raised,Local / regional focus" | split: "," %}
        {% for tag in tags %}
        <label class="pill pill--checkbox">
          <input type="checkbox" name="practices" value="{{ tag }}">
          <span>{{ tag }}</span>
        </label>
        {% endfor %}
      </div>
      <textarea id="other_practices" name="other_practices" rows="2" placeholder="Other practices (optional)"></textarea>
    </div>

    <div class="form-group">
      <label for="products">Products (one per line or comma separated)</label>
      <textarea id="products" name="products" rows="3"></textarea>
    </div>

    <div class="form-group">
      <label for="services">Services / channels (one per line or comma separated)</label>
      <textarea id="services" name="services" rows="3"></textarea>
    </div>

    <div class="form-group split">
      <div>
        <label for="hours">Hours / schedule (optional)</label>
        <textarea id="hours" name="hours" rows="2" placeholder="e.g. Mon–Fri 9–5"></textarea>
      </div>
      <div>
        <label for="market_days">Market days (optional, one per line)</label>
        <textarea id="market_days" name="market_days" rows="2" placeholder="e.g. Sat 8–12pm"></textarea>
      </div>
    </div>

    <div class="form-group" id="update_field" style="display: none;">
      <label for="updates">What needs to be updated or corrected?</label>
      <textarea id="updates" name="updates" rows="3"></textarea>
    </div>

    <div class="form-group" id="extra_field">
      <label for="notes">Anything else we should know?</label>
      <textarea id="notes" name="notes" rows="3"></textarea>
    </div>

    <input type="hidden" id="slug" name="slug">
    <input type="hidden" id="owner_name" name="owner_name">
    <input type="hidden" id="lat" name="lat">
    <input type="hidden" id="lon" name="lon">
    <input type="hidden" id="supplies_to" name="supplies_to">
    <input type="hidden" id="sources" name="sources">
    <input type="hidden" id="seo_description" name="seo_description">

    <button type="submit" class="button">Send via email</button>
  </form>
</section>

<script>
  const submitForm = document.getElementById('submitForm');
  const params = new URLSearchParams(window.location.search);
  const nameInput = document.getElementById('name');
  const slugInput = document.getElementById('slug');
  const submissionTypeRadios = submitForm.querySelectorAll('input[name="submission_type"]');
  const ownerCheckbox = document.getElementById('owner_checkbox');
  const ownerNameField = document.getElementById('owner_name');
  const submitterNameField = document.getElementById('submitter_name');
  const placeType = document.getElementById('place_type');
  const updateField = document.getElementById('update_field');
  const extraField = document.getElementById('extra_field');

  const listingRef = params.get('listing') || '';
  const presetName = params.get('name');
  const presetSubmissionType = params.get('submission_type');
  const presetOwner = params.get('owner_name');

  if (params.get('type') === 'community' && placeType) {
    placeType.value = 'community';
  }

  if (presetName && nameInput) {
    nameInput.value = presetName;
  } else if (listingRef && nameInput) {
    nameInput.value = listingRef;
  }
  if (listingRef && slugInput && !slugInput.value) {
    slugInput.value = listingRef;
  }

  const shouldSetUpdate =
    (presetSubmissionType && presetSubmissionType.toLowerCase().includes('update')) || Boolean(listingRef);
  if (shouldSetUpdate && submissionTypeRadios.length) {
    submissionTypeRadios.forEach((radio) => {
      radio.checked = radio.value === 'update';
    });
  }

  if (presetOwner && submitterNameField) {
    submitterNameField.value = presetOwner;
    if (ownerCheckbox) ownerCheckbox.checked = true;
  }

  const slugify = (value) =>
    (value || '')
      .toLowerCase()
      .trim()
      .replace(/[^a-z0-9\s-]/g, '')
      .replace(/\s+/g, '-')
      .replace(/-+/g, '-');

  const splitList = (value) =>
    (value || '')
      .split(/[,\n]/)
      .map((v) => v.trim())
      .filter(Boolean);

  const formatList = (label, items) => {
    if (!items.length) return `${label}: []`;
    return `${label}:\n${items.map((item) => `  - ${item}`).join('\n')}`;
  };

  const formatMultiline = (label, value) => {
    const text = (value || '').trim();
    return `${label}: >\n  ${text.replace(/\r?\n/g, '\n  ')}`;
  };

  const buildYaml = (data, action, targetSlug) => {
    const otherPractices = splitList(data.get('other_practices'));
    const listFields = {
      practices: [...splitList(data.getAll('practices').join(',')), ...otherPractices],
      products: splitList(data.get('products')),
      services: splitList(data.get('services')),
      social: splitList(data.get('social')),
      market_days: splitList(data.get('market_days')),
      supplies_to: splitList(data.get('supplies_to')),
      sources: splitList(data.get('sources'))
    };
    const name = data.get('name') || '';
    const countrySlug = data.get('country_slug') || 'new-zealand';
    const countryLabel = countrySlug === 'australia' ? 'Australia' : 'New Zealand';
    const slug = data.get('slug') || targetSlug || slugify(name);
    const collection = data.get('place_type') || '';
    const shortDescription = data.get('short_description') || '';
    const fullDescription = (data.get('full_description') || '').trim();
    const descriptionText = shortDescription || fullDescription;
    const submitterName = data.get('submitter_name') || '';
    const ownerName = data.get('owner_checkbox') ? submitterName || data.get('owner_name') || '' : data.get('owner_name') || '';

    const yamlLines = [
      '---',
      `title: ${name}`,
      `slug: ${slug}`,
      `collection: ${collection}`,
      `country_slug: ${countrySlug}`,
      `country: ${countryLabel}`,
      `region: ${data.get('region') || ''}`,
      `city: ${data.get('city') || ''}`,
      `address: ${data.get('address') || ''}`,
      `suburb: ${data.get('suburb') || ''}`,
      `postcode: ${data.get('postcode') || ''}`,
      formatMultiline('description', descriptionText),
      formatMultiline('seo_description', data.get('seo_description')),
      formatList('practices', listFields.practices),
      formatList('products', listFields.products),
      formatList('services', listFields.services),
      `website: ${data.get('website') || ''}`,
      `email: ${data.get('email') || ''}`,
      `phone: ${data.get('phone') || ''}`,
      formatList('social', listFields.social),
      `hours: ${data.get('hours') || ''}`,
      formatList('market_days', listFields.market_days),
      `lat: ${data.get('lat') || ''}`,
      `lon: ${data.get('lon') || ''}`,
      formatList('supplies_to', listFields.supplies_to),
      formatList('sources', listFields.sources),
      '---'
    ];

    const ownerIsContact = data.get('owner_checkbox') ? 'yes' : 'no';
    const submitterNotes = [
      '# Submitter notes',
      `owner_is_contact: ${ownerIsContact}`,
      `owner_name: ${ownerName}`,
      `submitter_name: ${submitterName}`,
      `submitter_email: ${data.get('submitter_email') || ''}`
    ];
    if (action === 'update') {
      submitterNotes.push('what_changed: |');
      submitterNotes.push(`  ${(data.get('updates') || '').replace(/\r?\n/g, '\n  ')}`);
    } else {
      submitterNotes.push('extra_comments: |');
      submitterNotes.push(`  ${(data.get('notes') || '').replace(/\r?\n/g, '\n  ')}`);
    }

    const headerLines = [
      `# ACTION: ${action === 'update' ? 'UPDATE_LISTING' : 'NEW_LISTING'}`,
      action === 'update' ? `# TARGET_SLUG: ${targetSlug || slug}` : null
    ].filter(Boolean);

    const sections = [
      headerLines.join('\n'),
      yamlLines.join('\n'),
      '# Full description (markdown)',
      fullDescription || '[add long-form description here]',
      submitterNotes.join('\n')
    ];

    return sections.join('\n\n');
  };

  const toggleNotesFields = () => {
    const action = Array.from(submissionTypeRadios).find((r) => r.checked)?.value || 'new';
    if (updateField) updateField.style.display = action === 'update' ? 'block' : 'none';
    if (extraField) extraField.style.display = action === 'update' ? 'none' : 'block';
  };

  submissionTypeRadios.forEach((radio) => {
    radio.addEventListener('change', toggleNotesFields);
  });
  toggleNotesFields();

  submitForm.addEventListener('submit', (e) => {
    e.preventDefault();
    const currentName = nameInput ? nameInput.value : '';
    if (slugInput && !slugInput.value) {
      slugInput.value = slugify(currentName);
    }
    if (ownerNameField && submitterNameField && ownerCheckbox && ownerCheckbox.checked) {
      ownerNameField.value = submitterNameField.value || '';
    }
    const data = new FormData(submitForm);
    const subType = data.get('submission_type') || 'new';
    const name = data.get('name') || '';
    const targetSlug = listingRef || data.get('slug') || slugify(name);
    const action = subType === 'update' ? 'update' : 'new';
    const subject =
      action === 'update'
        ? `[HOMEGROWN] UPDATE_LISTING: ${targetSlug || name}`
        : `[HOMEGROWN] NEW_LISTING: ${name}`;

    const body = buildYaml(data, action, targetSlug);
    const mailto = `mailto:josh@stonetosky.nz?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    window.location.href = mailto;
  });
</script>

---
layout: null
permalink: /search.json
---
[
{% assign all = site.farms | concat: site.markets | concat: site.stores | concat: site.restaurants | concat: site.distributors | concat: site.vendors %}
{% for doc in all %}
  {% if doc.type == "brand" or doc.subtype == "brand" or doc.listing_type == "brand" %}
    {% continue %}
  {% endif %}
  {% assign display_type = doc.collection | capitalize %}
  {% assign type_token = doc.collection %}
  {% assign subtype_raw = doc.subtype | default: doc.type | default: doc.listing_type | default: doc.category %}
  {% case doc.collection %}
    {% when 'stores' %}
      {% assign display_type = 'Grocer' %}
      {% assign type_token = 'grocer' %}
    {% when 'restaurants' %}
      {% assign display_type = 'Eatery' %}
      {% assign type_token = 'restaurant' %}
    {% when 'vendors' %}
      {% assign display_type = 'Eatery' %}
      {% assign type_token = 'restaurant' %}
    {% when 'distributors' %}
      {% assign display_type = 'Hub' %}
      {% assign type_token = 'distributor' %}
    {% when 'farms' %}
      {% assign type_token = 'farm' %}
    {% when 'markets' %}
      {% assign type_token = 'market' %}
  {% endcase %}
  {% assign subtype_token = subtype_raw | default: type_token | slugify %}
  {% if doc.practices_tags and doc.practices_tags != empty %}
    {% assign practices = doc.practices_tags | uniq | compact %}
  {% elsif doc.practices %}
    {% assign practices = doc.practices | uniq | compact %}
  {% else %}
    {% assign practices = '' | split: ',' %}
  {% endif %}

  {% if doc.products_tags and doc.products_tags != empty %}
    {% assign products = doc.products_tags | uniq | compact %}
  {% elsif doc.products %}
    {% assign products = doc.products | uniq | compact %}
  {% else %}
    {% assign products = '' | split: ',' %}
  {% endif %}

  {% if doc.services_tags and doc.services_tags != empty %}
    {% assign services = doc.services_tags | uniq | compact %}
  {% elsif doc.services %}
    {% assign services = doc.services | uniq | compact %}
  {% else %}
    {% assign services = '' | split: ',' %}
  {% endif %}

  {% if doc.specialty_tags %}
    {% assign specialty = doc.specialty_tags | uniq | compact %}
  {% else %}
    {% assign specialty = '' | split: ',' %}
  {% endif %}
  {% assign supplies_raw = doc.supplies_to %}
  {% if supplies_raw == nil or supplies_raw == empty %}
    {% assign supplies_list = '' | split: ',' %}
  {% elsif supplies_raw.first %}
    {% assign supplies_list = supplies_raw | uniq %}
  {% else %}
    {% assign supplies_list = supplies_raw | split: ',' | map: 'strip' | where_exp: 'item', 'item != ""' | uniq %}
  {% endif %}
  {% assign sourced_from_raw = doc.sourced_from %}
  {% if sourced_from_raw == nil or sourced_from_raw == empty %}
    {% assign sourced_from_list = '' | split: ',' %}
  {% elsif sourced_from_raw.first %}
    {% assign sourced_from_list = sourced_from_raw | uniq %}
  {% else %}
    {% assign sourced_from_list = sourced_from_raw | split: ',' | map: 'strip' | where_exp: 'item', 'item != ""' | uniq %}
  {% endif %}
  {% assign long_desc = doc.description | default: doc.short_description | default: doc.meta_description | default: doc.excerpt | default: doc.long_description %}
  {% assign geo_precision = doc.geo_precision | default: 'none' %}
  {% assign lat_val = doc.lat %}
  {% assign lon_val = doc.lon %}
  {
    "id": "{{ doc.id | default: doc.slug | slugify }}",
    "title": {{ doc.title | default: doc.name | jsonify }},
    "name": {{ doc.name | default: doc.title | jsonify }},
    "collection": "{{ doc.collection }}",
    "type": "{{ display_type }}",
    "type_token": "{{ type_token }}",
    "subtype": {{ subtype_raw | default: type_token | jsonify }},
    "subtype_token": "{{ subtype_token }}",
    "slug": {% if doc.slug %}{{ doc.slug | jsonify }}{% else %}null{% endif %},
    "url": "{{ doc.url | relative_url }}",
    "country": {{ doc.country | jsonify }},
    "country_slug": {{ doc.country_slug | jsonify }},
    "region": {{ doc.region | jsonify }},
    "city": {{ doc.city | jsonify }},
    "address": {{ doc.address | jsonify }},
    "practices": {{ practices | jsonify }},
    "products": {{ products | jsonify }},
    "services": {{ services | jsonify }},
    "specialty_tags": {{ specialty | jsonify }},
    "supplies_to": {{ supplies_list | jsonify }},
    "sourced_from": {{ sourced_from_list | jsonify }},
    "hours": {{ doc.hours | jsonify }},
    "lat": {% if lat_val == nil or lat_val == '' %}null{% else %}{{ lat_val | jsonify }}{% endif %},
    "lon": {% if lon_val == nil or lon_val == '' %}null{% else %}{{ lon_val | jsonify }}{% endif %},
    "geo_precision": {{ geo_precision | jsonify }},
    "geo_source": {{ doc.geo_source | jsonify }},
    "geo_query": {{ doc.geo_query | jsonify }},
    "geo_label": {{ doc.geo_label | jsonify }},
    "geo_last_verified": {{ doc.geo_last_verified | jsonify }},
    "featured": {{ doc.featured | default: false | jsonify }},
    "description": {{ long_desc | strip_html | strip_newlines | jsonify }}
  }{% unless forloop.last %},{% endunless %}
{% endfor %}
]
